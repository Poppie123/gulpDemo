<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>商品详情</title>
    <link rel="stylesheet" href="../../css/cleardefault.css">
    <link rel="stylesheet" href="../../css/iconfont.css">
    <link rel="stylesheet" href="../../css/swiper.css">
    <link rel="stylesheet" href="../../css/shopping-detail.css">
    <link rel="stylesheet" href="../../css/hui.css">

    <style>
        .mark {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            background-color: #000;
            opacity: .55;
            z-index: 995;
            display: none;
        }

        .none {
            display: none;
        }

        .popup {
            font-size: 0;
            bottom: 0;
            width: 100%;
            height: 7.95rem;
            background: #FFFFFF;
            position: fixed;
            z-index: 996;
        }

        .combo .quantity {
            position: absolute;
            display: flex;
            justify-content: space-between;
            width: 1.49rem;
            height: .36rem;
            color: rgba(204, 204, 204, 1);
            border: 1px solid rgba(204, 204, 204, 1);
            border-radius: 2px;
            /* margin-left: 5.39rem; */
            line-height: .36rem;
            text-align: center;
        }

        #big img {
            width: 100%;
            height: auto;
            margin: 0 auto;
        }

        .propuct-detail {
            width: 100%;
            height: auto;
            background: #fff;
            font-size: .28rem;
            color: #333;
            padding-top: .29rem;
        }

        .footer .active .text {
            color: #9c53f6;
        }

        .colloct p {
            font-size: .24rem;
            font-weight: 400;
            color: #333;
        }

        .footer .active .iconfont {
            color: #9c53f6;
        }

        /* 弹窗开始 */

        .popup-top {
            overflow: visible;
            position: relative;
        }

        .popup-combo li:nth-of-type(odd)

        /* 奇数行   */
            {
            float: left;
        }

        .popup-combo li:nth-of-type(even)

        /* 偶数行   */
            {
            float: right;
        }
    </style>
</head>

<body>
    <!--  banner部分开始  -->
    <div class="banner">
        <i class="iconfont iconiconfontjiantou1 link-to" data-href="../index.html"></i>
        <div class="swiper-container">
            <div class="swiper-wrapper">
                <!-- <div class="swiper-slide"><img src="../../image/bed.png"></div>
                <div class="swiper-slide"><img src="../../image/bed.png"></div>
                <div class="swiper-slide"><img src="../../image/bed.png"></div> -->
            </div>
            <!-- 如果需要分页器 -->
            <div class="swiper-pagination"></div>
        </div>
    </div>
    <!-- 信息部分开始 -->
    <div class="detail-new">
        <div class="detail-content">
            <div class="shop-price"></div>
            <div class="market-price"></div>
            <div class="china"></div>
            <div class="sold">
                <span class="sold-write"></span>
                <span class="sold-write"></span>
                <span class="sold-write">运费:&nbsp;0</span>
            </div>
        </div>
    </div>
    <!-- 图片部分开始 -->
    <div class="detail-picter">
        <img src="../../image/item.png" alt="">
    </div>
    <!-- 套餐部分开始 -->
    <div class="combo">
        <div class="spec">
            <span class="spec-left">选择规格</span>
            <span class="spec-right">套餐一&nbsp;></span>
        </div>
        <div class="num">
            <span class="num-left">数量</span>
            <div class="quantity">
                <div class="subtract">-</div>
                <div class="much">1</div>
                <div class="add">+</div>
            </div>
        </div>
    </div>

    <!-- 内容部分开始 -->
    <div class="propuct-detail">
        <div class="propuct-content">
            <div class="evaluate link-to" data-href="./shopping-assess.html">
                <div class="line"></div>
                <div class="evaluate-new">
                    商品评价&nbsp;
                    <span>(4526人评价)</span>
                </div>
                <i class="iconfont icongengduo"></i>
            </div>

            <div class="ailisi">
                <div class="ailisi-content">
                    <img id="ailisi-a" src="../../image/picter.png" alt="">
                    <span class="name">爱丽丝</span>
                    <span class="time">2019-05-22&nbsp;16:22</span>
                    <div class="tubiao">
                        <i class="iconfont iconpingfen yanse"></i>
                        <i class="iconfont iconpingfen yanse"></i>
                        <i class="iconfont iconpingfen yanse"></i>
                        <i class="iconfont iconpingfen yanse"></i>
                        <i class="iconfont iconpingfen yanseh"></i>
                        <span class="fenshu">4.6分</span>
                    </div>
                    <span class="ailisi-news">检查过了是正品,质量超好，很开心的一次网购。第一次用这个平台，没想价格便宜，东西又好，还会再来</span>
                    <div class="picter-content">
                        <img id="picter-item" src="../../image/bed1.png" alt="">
                        <img id="picter-item" src="../../image/bed1.png" alt="">
                        <img id="picter-item" src="../../image/bed1.png" alt="">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 商品详情部分开始 -->
    <div class="propuct-detail">
        <div class="propuct-content">
            <div class="evaluate">
                <div class="line"></div>
                <div class="evaluate-new">商品详情</div>
                <i class="iconfont icongengduo"></i>
            </div>
        </div>
        <div class="bigg" id="big"></div>
    </div>


    <!-- 底部开始 -->
    <div class="footer">
        <div class="footer-content">
            <div class="ser-shop">
                <div class="service">
                    <i class="iconfont icondaohang3dtouchgouwuche"></i>
                    <p>购物车</p>
                </div>
                <div class="service">
                    <i class="iconfont iconkefu"></i>
                    <p>客服</p>
                </div>
                <div class="service colloct">
                    <i class="iconfont iconziyuan"></i>
                    <p class="text">收藏</p>
                </div>
            </div>
            <div class="fl join-shop">立即购买</div>
            <div class="fl buy">加入购物车</div>
        </div>
    </div>

    <!-- 弹窗开始 -->
    <div class="mark"></div>
    <div class="popup none">
        <div class="popup-top">
            <div class="taoyan">
                <img id="taoyan" src="" alt=""></div>
            <span class="popup-five"></span>
            <span class="popup-cost coss"></span>
            <span class="popup-price"></span>
        </div>
        <div class="popup-center">
            <div class="spec">规格</div>
            <div class="combo-flex"></div>
            <div class="popup-combo">
                <ul>
                    <li class="commm">
                        <!-- <div class="combo-item">套餐一</div> -->
                    </li>
                </ul>
            </div>

        </div>
        <div class="number">数量</div>
        <div class="quantity">
            <div class="subtract">-</div>
            <div class="much bmuh">1</div>
            <div class="add">+</div>
        </div>
        <div class="popup-bottom">
            <div class="popup-bottom-left">合计金额：<span class=""></span></div>
            <div class="popup-bottom-center">加入购物车</div>
            <div class="popup-bottom-right join-shop botrr">立即购买</div>
        </div>
    </div>



    <script src="../../js/jquery-3.3.1.min.js"></script>
    <script src="../../js/swiper.js"></script>
    <script src="../../js/hui.js"></script>
    <script src="../../js/hui-refresh-load-more.js"></script>
    <script src="../../js/common.js"></script>
    <script>

    </script>
    <script>
        $(document).ready(function () {
            var id = getQueryString('id')
            console.log(id);
            getGoodsDetail()
            getGoodsIsCollect()

            //替换轮播图
            function getGoodsDetail() {
                reqAjax('/api/goods/get_goods_detail', { id: id, start: 0 }, function (res) {
                    if (res.code == 1) {
                        var bannnerList = res.data.goods_imgs || [];
                        var bannerStr = "";
                        bannnerList.map(function (v) {
                            bannerStr += '<div class="swiper-slide"><img src="' + v.img + '" alt=""></div>'
                        })
                        $('.swiper-wrapper').html(bannerStr);
                        //轮播图
                        var swiper = new Swiper('.swiper-container', {
                            loop: true,
                            pagination: {
                                el: '.swiper-pagination',
                            },
                            autoplay: {
                                delay: 5000, //5秒切换一次
                                disableOnInteraction: false,
                            },
                        })
                        var dt = res.data || []
                        //产品信息
                        $('.shop-price').html('￥' + dt.shop_price);
                        $('.market-price').html('￥' + dt.market_price);
                        $('.china').html(dt.goods_name);
                        $('.sold span:eq(0)').html('已售：' + dt.sales);
                        $('.sold span:eq(1)').html('库存：' + dt.goods_stock);
                        $('.spec-right').html(dt.content)
                        $('#big').html(dt.detail);
                        //弹窗
                        $('.popup-five').html(dt.goods_name);
                        $('.coss').html(dt.shop_price);
                        $('.popup-price').html(dt.market_price);
                        var popList = res.data.attribute || [];
                        var imgHtml = '';
                        var moneyHtml = '';
                        var numberHtml = '';
                        popList.map(function (v) {
                            imgHtml += '<img id="taoyan" src="' + v.img + '">'
                            moneyHtml += '<span class="">' + v.price + '</span>'
                            numberHtml += '<div class="combo-item active" data-id="' + v.id + '">' + v.attr + '</div>'
                        })
                        $('.taoyan').html(imgHtml);
                        $('.popup-bottom-left span').html('￥' + moneyHtml);
                        $('.popup-combo').html(numberHtml);
                    }
                })
            }
            //套餐调出弹窗设置
            $('.spec-right').click(function () {
                popup()
            })
            $(".mark").click(function () {
                popuper()
            });
            function popup() {
                $('.mark').css('display', 'block');
                $('.popup').removeClass('none');
                $('popup-top').show();
            }
            function popuper() {
                $('.mark').css('display', 'none');
                $('.popup').addClass('none');
            }
            //获取收藏情况
            function getGoodsIsCollect() {
                if (!isLogin()) {
                    window.location.href = '../login.html'
                }
                reqAjax('/api/goods/is_collect', { goods_id: id }, function (res) {
                    if (res.code == 1) {
                        // hui.toast('收藏成功');
                        $('.colloct').addClass('active')
                    } else {
                        $('.colloct').removeClass('active')
                    }
                })
            }
            //切换收藏
            $('.colloct').click(function () {
                if (!isLogin()) {
                    window.location.href = '../user/login.html'
                }
                reqAjax('/api/goods/goods_collect', { goods_id: id }, function () {
                })
                $(this).toggleClass('active')
                console.log(2)
            })

            //跳转订单
            $('.botrr').click(function () {
                // if ($('.mask').is(':visible')) {
                //     if (!isLogin()) {
                //         window.location.href = '../user/login.html'
                //         return false
                //     }
                var addressData = {}
                reqAjax('/api/user/get_my_address', { start: 0 }, function (res) {//获取所有地址信息
                    if (res.code == 1) {
                        var goodsobj = {
                            type: 1,
                            goods_id: id,
                            goods_attr_id: $('.popup-combo .active').data('id'),
                            address_id: "",
                            goods_num: $('.bmuh').html(),
                        }
                        if (res.code == 1 && res.data.length > 0) {
                            localStorage.setItem('addressData', JSON.stringify(res.data[0]));//拿到默认地址信息
                        }
                        localStorage.setItem('ordercheck', JSON.stringify(goodsobj))//将订单审核的信息存入缓存
                        window.location.href = '../order/submit-order.html?id=' + id;
                    }
                })
                // } else {
                //     popup()
                // }
            })

            //加入购物车
            $('.popup-bottom-center').click(function () {
                // if ($('.mask').is(':visible')) {
                //传输信息给购物车
                var goods_name = $('.popup-five').html()
                console.log(goods_name)
                var goods_num = $('.much').html()
                console.log(goods_num)
                var shop_price = $('.shop-price').html().slice(1);
                console.log(shop_price)
                var goods_attr_value = $('.popup-combo').find('.active').html();
                console.log(goods_attr_value)
                reqAjax('/api/app/add_goods_cart', { goods_id: id, goods_name: goods_name, goods_num: goods_num, goods_attr_value: goods_attr_value, shop_price: shop_price }, function (res) {
                    if (res.code == 1) {
                        hui.toast('加入购物车成功');
                        // hui.toast(res.msg)
                    }
                })
                // popuper()
                // } else {
                //     popup()
                // }
            })

            //选择套餐
            $('body').on('click', '.combo-item', function () {
                $('.combo-item').removeClass('active');
                $(this).addClass('active');
                var a = $(this).html();
                $('.spec-right').html(a);
                var b = $(this).index();
                console.log(b);
                $('.taoyan').hide();
                $('.taoyan:eq(' + b + ')').show();
                console.log($('.taoyan img:eq(' + b + ')').attr('src'))
                $('.popup-bottom-left span').hide();
                $('.popup-bottom-left span:eq(' + b + ')').show();
                console.log($('.popup-bottom-left span:eq(' + b + ')').html())
                sum()
            })
            // ++
            $('.add').click(function () {
                var a = $('.much').html()
                a++
                $('.much').html(a)
                sum()
            })

            //--
            $('.subtract').click(function () {
                var a = $('.much').html()
                a--
                if (a <= 1) {
                    return
                }
                else {
                    a--
                }
                $('.much').html(a)
                sum()
            })
            //合计金额
            function sum() {
                var a = $('.coss').html();
                var b = $('.much').html();
                var c = a * b;
                $('.popup-bottom-left span').html('￥' +c)
                console.log(c)
                console.log(a)
                console.log(b)
            }

        })
    </script>
</body>

</html>